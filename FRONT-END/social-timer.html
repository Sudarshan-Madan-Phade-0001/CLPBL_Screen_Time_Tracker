<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Social Media Timer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }
    
    body {
      overflow: hidden;
    }
    
    .timer-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 50px;
      background: #077b32;
      color: white;
      z-index: 9999;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      font-size: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    .timer-countdown {
      font-weight: bold;
      font-size: 18px;
    }
    
    .progress-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 4px;
      background: #ffffff;
      width: 100%;
      transform-origin: left;
    }
    
    .content-frame {
      position: fixed;
      top: 50px;
      left: 0;
      width: 100%;
      height: calc(100% - 50px);
      border: none;
    }
  </style>
</head>
<body>
  <div class="timer-bar">
    <div>Time remaining: <span id="timer-countdown">00:00</span></div>
    <div>Session will end automatically</div>
    <div class="progress-bar" id="progress-bar"></div>
  </div>
  
  <iframe id="content-frame" class="content-frame" src="about:blank"></iframe>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Get parameters from URL
      const urlParams = new URLSearchParams(window.location.search);
      const websiteUrl = urlParams.get('url');
      const minutes = parseInt(urlParams.get('minutes')) || 5;
      const returnUrl = urlParams.get('return') || 'website-blocker.html';
      
      // Set the iframe source
      const contentFrame = document.getElementById('content-frame');
      contentFrame.src = websiteUrl;
      
      // Set up the countdown
      let totalSeconds = minutes * 60;
      const initialSeconds = totalSeconds;
      const countdownEl = document.getElementById('timer-countdown');
      const progressBar = document.getElementById('progress-bar');
      
      function updateTimer() {
        const mins = Math.floor(totalSeconds / 60);
        const secs = totalSeconds % 60;
        countdownEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
        
        // Update progress bar
        const percentRemaining = (totalSeconds / initialSeconds) * 100;
        progressBar.style.transform = `scaleX(${percentRemaining / 100})`;
      }
      
      updateTimer();
      
      const timer = setInterval(() => {
        totalSeconds--;
        updateTimer();
        
        if (totalSeconds <= 0) {
          clearInterval(timer);
          
          // Store session data if needed
          try {
            const websiteData = JSON.parse(localStorage.getItem('digital_detox_website_limits')) || [];
            // Update session data if needed
          } catch (e) {
            console.error('Error updating session data:', e);
          }
          
          // Redirect to focus timer
          window.location.href = 'focus-timer.html';
        }
      }, 1000);
      
      // Prevent navigation away from this page
      window.addEventListener('beforeunload', (e) => {
        if (totalSeconds > 0) {
          e.preventDefault();
          e.returnValue = 'Your social media session is still active. Are you sure you want to leave?';
          return e.returnValue;
        }
      });
    });
  </script>
</body>
</html>